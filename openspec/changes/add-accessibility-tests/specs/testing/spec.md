# Specification Delta: Testing

Change ID: `add-accessibility-tests`

## Summary

This change introduces accessibility testing as a formal testing capability for the project.

## ADDED Requirements

### Requirement: Automated Accessibility Validation

MUST include automated tests that validate HTML structure, semantic markup, ARIA attributes, and visual accessibility compliance with WCAG 2.1 AA standards.

#### Scenario: Developer runs accessibility tests locally
- Developer runs: `pytest tests/accessibility/`
- Tests build example documentation sites
- Tests validate HTML5 structure, semantic elements, ARIA attributes
- Test results show clear violations with line numbers and suggestions
- Exit code is 0 if all tests pass, non-zero if failures exist

#### Scenario: CI validates accessibility on every PR
- GitHub Actions workflow runs accessibility tests automatically
- Tests must pass for PR to be mergeable (unless marked experimental)
- Failures block merge with clear error messages
- Reports generated show which specific elements violate standards

#### Scenario: Theme developer detects missing alt text during development
- Developer updates image in theme template
- Runs `pytest tests/accessibility/test_image_validation.py`
- Test fails with message: "Image logo.png missing alt attribute"
- Developer adds alt text and test passes

#### Scenario: Color contrast issue is caught before release
- Designer changes search box background color in CSS
- CI accessibility tests run
- Test detects contrast ratio 3.2:1 < required 4.5:1
- Developer adjusts color to meet WCAG AA standard
- Test passes and change can be merged

### Requirement: HTML Validation

MUST validate that all generated HTML conforms to HTML5 specification and uses semantic markup appropriately.

#### Scenario: Verify semantic structure of theme templates
- Tests scan all theme templates for proper use of semantic elements
- Verify `<nav>`, `<main>`, `<aside>`, `<article>` are used appropriately
- Headings are properly structured (h1, h2, h3... not skipping levels)
- No duplicate IDs within a page
- Form inputs are properly associated with labels

#### Scenario: Detect invalid HTML in generated site
- Built site contains invalid HTML5 (e.g., unclosed tags)
- HTML validation test fails with location and type of error
- Developer fixes template or configuration
- Test passes

### Requirement: ARIA Validation

MUST validate that ARIA attributes are used correctly according to ARIA Authoring Practices Guide specifications.

#### Scenario: Verify search modal ARIA attributes
- Search modal has `role="alertdialog"` or `role="dialog"`
- Modal has `aria-modal="true"`
- Modal has `aria-labelledby` pointing to modal title
- Close button has `aria-hidden="true"` or descriptive aria-label

#### Scenario: Check interactive element ARIA compliance
- Buttons have proper `role="button"` or are `<button>` elements
- Links have descriptive text or `aria-label`
- Navigation regions have `role="navigation"` or are `<nav>`
- ARIA roles match interactive behavior

### Requirement: Color Contrast Validation

MUST validate that text and interactive elements meet WCAG 2.1 AA color contrast standards (4.5:1 minimum for normal text, 3:1 for large text or UI components).

#### Scenario: Detect low contrast text in theme
- Theme CSS defines body text color: `#666` on background `#fff`
- Contrast ratio: 5.74:1 → PASS
- Developer changes to `#888` on `#fff`
- Contrast ratio: 3.16:1 → FAIL
- Test reports violation with suggestion to use darker color

#### Scenario: Verify focus indicator contrast
- Focus state on buttons has sufficient contrast
- Focus indicators are visible (not removed with `outline: none`)
- Keyboard navigation focus states meet contrast requirements

### Requirement: Content Accessibility

MUST validate that content within generated sites includes proper alt text, descriptive link text, and other content accessibility requirements.

#### Scenario: Image alt text validation
- All images have `alt` attributes or `data-decorative` marker
- Alt text is descriptive (not "image", "photo", or empty)
- Decorative images can have empty alt text with explicit marking

#### Scenario: Link text validation
- Links have visible, descriptive text (not "click here", "link", empty)
- Links have `href` attributes
- Links with only icon content have `aria-label` or title

#### Scenario: Heading hierarchy validation
- Document has exactly one `<h1>` as main heading
- No skipped heading levels (e.g., h1 → h3 without h2)
- Heading text is descriptive

## MODIFIED Requirements

N/A — This change introduces new capabilities, not modifications to existing ones.

## REMOVED Requirements

N/A — This change does not remove existing requirements.

## Related Capabilities

- **Theme** — Affects HTML structure generated by theme templates
- **Plugins** — Some plugins may be validated for accessibility output
- **Testing** — This capability defines testing procedures

## Notes

- Accessibility testing is automated and covers static structure only
- Runtime accessibility behavior requires additional integration tests
- Screen reader testing requires manual testing with actual screen readers
- Accessibility standards may be updated; tests should be reviewed annually
