{% set features = config.theme.features or [] %}
{% set palette_name = config.theme.palette or "default" %}
{% set palette_config = config.theme.palette_config or {} %}
{% set valid_options = palette_config.get("valid_options", []) %}

<!--
  FOUC Prevention Script
  
  CRITICAL: This script MUST execute synchronously BEFORE stylesheets are linked.
  
  - MUST be inline (not external file)
  - MUST NOT use defer or async attributes
  - MUST appear before <link rel="stylesheet"> tags
  
  This ensures the data-palette attribute is set before CSS is parsed,
  preventing a flash of unstyled content (FOUC) when restoring the user's
  saved palette preference from localStorage.
-->
<script>
(function() {
  try {
    var saved = localStorage.getItem('mkdocs-terminal-palette');
    var available = {{ valid_options | map(attribute='name') | list | tojson }};
    // Validate saved palette is in available options
    if (saved && available.indexOf(saved) !== -1) {
      document.documentElement.setAttribute('data-palette', saved);
    }
  } catch (e) {
    // localStorage may be blocked, fail silently
  }
})();
</script>

<link href="{{ 'css/fontawesome/css/fontawesome.min.css' | url }}" rel="stylesheet">
<link href="{{ 'css/fontawesome/css/solid.min.css' | url }}" rel="stylesheet">
<link href="{{ 'css/normalize.css' | url }}" rel="stylesheet">
<link href="{{ 'css/terminal.css' | url }}" rel="stylesheet">
<link href="{{ 'css/theme.css' | url }}" rel="stylesheet">
<link href="{{ 'css/theme.tile_grid.css' | url }}" rel="stylesheet">
<link href="{{ 'css/theme.footer.css' | url }}" rel="stylesheet">

{%- if palette_config.get("selector_enabled") and valid_options %}
<!-- Palette selector enabled - link all configured palette CSS files -->
{%- for option in valid_options %}
{%- if option.get("css") %}
<!-- Custom palette: {{ option.name }} -->
<link href="{{ option.css | url }}" rel="stylesheet">
{%- else %}
<!-- Bundled palette: {{ option.name }} -->
<link href="{{ ('css/palettes/' ~ option.name ~ '.css') | url }}" rel="stylesheet">
{%- endif %}
{%- endfor %}
{%- else %}
<!-- Palette selector disabled - link default palette only -->
<link href="{{ ('css/palettes/' ~ palette_name ~ '.css') | url }}" rel="stylesheet">
{%- endif %}

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

{% if 'navigation.side.hide' not in features -%}
/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}
{%- endif -%}
</style>

{% if 'navigation.top.cursor_animation.hide' in features -%}
<!-- cursor_animation override -->
<style>
  #mkdocs-terminal-site-name.terminal-prompt::after {
      display: none;
  }
</style>
{%- endif -%}

{% if 'style.links.underline.hide' in features -%}
<!-- link underline override -->
<style>
#terminal-mkdocs-main-content a:not(.headerlink){
    text-decoration: none;
}
</style>
{%- endif -%}